---

copyright:
  years: 2019
lastupdated: "2019-06-18"

keywords: getting started tutorials, create a CA, enroll, register, create an MSP, wallet, create a peer, create ordering service, Raft

subcollection: blockchain

---

{:external: target="_blank" .external}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:note: .note}
{:important: .important}
{:tip: .tip}
{:pre: .pre}

# ネットワーク構築チュートリアル
{: #ibp-console-build-network}

{{site.data.keyword.blockchainfull}} Platform は、ブロックチェーンのアプリケーションとネットワークを開発、デプロイ、運用できるようにする Blockchain as a Service オファリングです。 ブロックチェーンの各コンポーネントの概要およびコンポーネント同士の連携について詳しくは、[ブロックチェーン・コンポーネントの概要](/docs/services/blockchain?topic=blockchain-blockchain-component-overview#blockchain-component-overview)を参照してください。 このチュートリアルは、[サンプル・ネットワークのチュートリアル・シリーズ](/docs/services/blockchain/howto?topic=blockchain-ibp-console-build-network#ibp-console-build-network-sample-tutorial)の第 1 部です。{{site.data.keyword.blockchainfull_notm}} Platform コンソールを使用して、選択したクラウド・インフラストラクチャーにデプロイした Kubernetes クラスター上に、正常に機能するネットワークを構築する方法を説明します。
{:shortdesc}


ベータ・トライアル・バージョンの {{site.data.keyword.blockchainfull_notm}} Platform for {{site.data.keyword.cloud_notm}} を使用している場合は、コンソールの一部のパネルが、一般出荷可能 (GA) サービス・インスタンスに合わせて最新の情報が記載されている現在の文書とは異なる可能性があります。 ベータ版のサービス・インスタンスを使用していて、最新機能をすべて利用したいという場合は、この段階で [{{site.data.keyword.blockchainfull_notm}} Platform for {{site.data.keyword.cloud_notm}} の概説](/docs/services/blockchain/howto?topic=blockchain-ibp-v2-deploy-iks#ibp-v2-deploy-iks)の手順に従い、GA サービス・インスタンスをプロビジョンすることをお勧めします。
{: important}

**対象者:** このトピックは、ブロックチェーン・ネットワークの作成、モニター、管理を担当するネットワーク・オペレーターを対象に設計されています。

まだ {{site.data.keyword.blockchainfull_notm}} Platform コンソールで {{site.data.keyword.cloud_notm}} Kubernetes Service を使用してコンポーネントを Kubernetes クラスターにデプロイしていない場合は、[{{site.data.keyword.blockchainfull_notm}} Platform for {{site.data.keyword.cloud_notm}} の概説](/docs/services/blockchain/howto?topic=blockchain-ibp-v2-deploy-iks#ibp-v2-deploy-iks) ({{site.data.keyword.cloud_notm}} クラスターを使用する場合) または [{{site.data.keyword.blockchainfull_notm}} Platform for Multicloud の概説](/docs/services/blockchain?topic=blockchain-get-started-console-icp#get-started-console-icp) ({{site.data.keyword.cloud_notm}} Private を使用して {{site.data.keyword.cloud_notm}} 以外のクラウド・プロバイダーにデプロイする場合) を参照してください。 コンソール自体はクラスター内に存在しないことに注意してください。 これは、クラスターにコンポーネントをデプロイするために使用できるツールです。

有料版または無料版のどちらの Kubernetes クラスターにコンポーネントをデプロイするかにかかわらず、ノードをデプロイしてチャネルを作成するときには、使用可能なリソースを慎重に確認してください。 Kubernetes クラスターを管理し、必要に応じて追加のリソースをデプロイする責任はユーザーにあります。 {{site.data.keyword.cloud_notm}} 無料版のクラスターにもコンポーネントは正常にデプロイできますが、追加するコンポーネントが多くなるほど、コンポーネントの実行速度は遅くなります。 コンポーネントのサイズ設定およびコンソールと {{site.data.keyword.cloud_notm}} Kubernetes Service クラスターの対話方法の詳細については、[リソースの割り振り](/docs/services/blockchain/howto?topic=blockchain-ibp-console-govern#ibp-console-govern-iks-console-interaction)を参照してください。 {{site.data.keyword.cloud_notm}} Private を使用して別のクラウド・プロバイダーにデプロイする場合は、そのプロバイダーの資料を参照し、そこでリソースをモニターする方法を確認する必要があります。

## サンプル・ネットワークのチュートリアル・シリーズ
{: #ibp-console-build-network-sample-tutorial}

この 3 部構成のチュートリアル・シリーズでは、{{site.data.keyword.blockchainfull_notm}} Platform コンソールを使用し Kubernetes クラスターへのネットワークのデプロイやスマート・コントラクトのインストールとインスタンス化を行うことで、比較的にシンプルなマルチノードの Hyperledger Fabric ネットワークを作成して相互接続するプロセスを体験していきます。 このチュートリアルでは、有料の {{site.data.keyword.cloud_notm}} Kubernetes クラスターを使用した場合のこのプロセスの仕組みを示しますが、いくつかの制限 (例えば、無料クラスターではノードのサイズ設定やサイズ変更はできません) を除き、同じ基本フローが無料クラスターにも適用されます。

これらのチュートリアルで説明しているコンポーネントの作成と管理のプロセスは、{{site.data.keyword.cloud_notm}} Private を使用して他のクラウド・プロバイダーにデプロイした環境にも適用されます。
{: important}

* **ネットワーク構築チュートリアル** このチュートリアルでは、2 つの組織を作成することでネットワークをホストするプロセスを学習します。組織の 1 つはピア用で、もう 1 つは順序付けサービスおよびチャネル用です。 順序付けサービスを作成して組織を追加することで、ブロックチェーン・コンソーシアムを形成する場合は、このチュートリアルを使用してください。
* [ネットワーク参加チュートリアル](/docs/services/blockchain/howto?topic=blockchain-ibp-console-join-network#ibp-console-join-network)では、ピアを作成して既存のチャネルに参加させることで、既存のネットワークに参加するプロセスを学習します。 このチュートリアルは、順序付けサービスを作成することでネットワークをホストする予定がない場合、あるいは他のネットワークに参加するプロセスを学習する場合に使用します。
* [ネットワークにスマート・コントラクトをデプロイする](/docs/services/blockchain/howto?topic=blockchain-ibp-console-smart-contracts#ibp-console-smart-contracts)では、スマート・コントラクトを作成してネットワークにデプロイする方法を学習します。


### このネットワークの構造
{: #ibp-console-build-network-structure}

**ネットワーク構築**のチュートリアルと**ネットワーク参加**のチュートリアルのすべての手順が完了すると、以下の図のようなネットワークになります。

![サンプルの基本ネットワーク構造](../images/ibp-v2-build-network.svg "サンプルの基本ネットワーク構造")

この構成は、アプリケーションおよびスマート・コントラクトのテスト用、およびコンポーネントを構築し、ユーザー独自のユース・ケースに合った実動ネットワークに参加するためのガイドとして十分です。 このネットワークには以下のコンポーネントが含まれています。

* **ピア組織 2 つ**: `Org1` および `Org2`  
  このチュートリアルのシリーズでは、ピア組織 2 つおよび関連するピア 2 つを作成する方法について説明します。 ブロックチェーン・ネットワーク上の組織は、互いに取り引きする必要がある 2 つの別々の銀行のようなものと考えてください。 `Org1` および `Org2` の定義を作成します。
* **1 つの順序付けサービス組織**: `Ordering Service`  
  分散台帳を作成するので、ピアと順序付けサービスは別々の組織に所属していなければなりません。 そのため、順序付けサービスのために別の組織を作成します。 特に、順序付けサービス・ノードは、トランザクションのブロックに順序を付け、台帳に書き込んでブロックチェーンにするためにピアに送るノードです。 `Ordering Service` 組織の定義を作成します。
* **3 つの認証局 (CA)**: `Org1 CA、Org2 CA、Ordering Service CA`   
  CA は、組織に関連付けられているユーザーおよびノードの両方に証明書を発行するノードです。 CA は組織ごとに 1 つデプロイするのがベスト・プラクティスです。そのため、各ピア組織用に 1 つと、順序付けサービス組織用に 1 つ、合計 3 つの CA をデプロイします。 これらの CA は、メンバーシップ・サービス・プロバイダー (MSP) によってカプセル化される、各組織の定義も作成します。 各組織 CA とともに TLS CA が自動的にデプロイされ、ノード間の通信に使用する TLS 証明書が提供されます。 詳しくは、[TLS CA の使用](/docs/services/blockchain/howto?topic=blockchain-ibp-console-identities#ibp-console-identities-tlsca)を参照してください。
* **1 つの順序付けサービス:** `Ordering Service`  
  有料クラスターで実行しているデプロイメントには、1 つのノードの順序付けサービスまたはクラッシュ・フォールト・トレラントの 5 つのノードの順序付けサービスのいずれかをデプロイするオプションがありますが、無料のクラスターで使用できるのは、単一のノードを実行するオプションのみです。 5 つのノードの順序付けサービスでは、Raft プロトコルの実装を使用し (Raft の詳細については、[The Ordering Service](https://hyperledger-fabric.readthedocs.io/en/release-1.4/orderer/ordering_service.html#raft){: external} を参照してください)、これがこのチュートリアルで使用するデプロイメント・オプションです。 現時点では、組織に関連付けられている順序付けノードの数にかかわらず、サポートされる順序付けサービス組織は順序付けサービスごとに 1 つのみです。 この順序付けサービスは、チャネルを作成し、チャネルに参加できるピア組織のリストである「コンソーシアム」にピア組織を追加します。 別々のクラスターにデプロイされている複数の組織を持つチャネルを作成する (ほとんどの実動ネットワークはこのような構造になっています) 場合、順序付けサービスの管理者は、別のコンソールにデプロイされているピア組織を自分のコンソールにインポートする必要があります。 これにより、その順序付けサービスでホストされているチャネルに、そのピア組織を参加させることができます。
* **ピア 2 つ:** `Peer Org1` および `Peer Org2`  
  上の図の台帳 `Ledger x` は分散ピアによって保守されています。 これらのピアは、[Couch DB](https://hyperledger-fabric.readthedocs.io/en/release-1.4/couchdb_as_state_database.html){: external} を状態データベースとして使用して、ピアに関連付けられている個別のコンテナーにデプロイされます。 このデータベースは、すべての「状態」(キーと値のペアによって表される) の現行値を保持します。 例えば、`Org1` (値) が銀行アセット (キー) の現在の所有者であるとします。 トランザクションのリストであるブロックチェーンは、ピア上にローカルに格納されます。
* **チャネル 1 つ**: `channel1`  
  チャネルにより、一連の組織は、チャネルのメンバーでない組織にデータを公開することなく取引を実行できます。 チャネルごとに独自の台帳があり、そのチャネルに参加しているピアによって共同で管理されます。 このチュートリアルでは、両方の組織が参加するチャネルを 1 つ作成し、そのチャネルで、両組織が取引のために使用できるスマート・コントラクトをインスタンス化する方法を示します。

この構成は必須ではありません。 {{site.data.keyword.blockchainfull_notm}} Platform はカスタマイズ性に優れています。 Kubernetes クラスター内に使用可能なリソースがある場合は、コンソールを使用して、無限に続く構成にコンポーネントをデプロイできます。 このチュートリアルでは、独自のネットワークを構築するために必要な手順について説明し、{{site.data.keyword.blockchainfull_notm}} Platform およびコンソールについてさらに詳しく学習できるトピックを紹介します。

この**ネットワーク構築**チュートリアルでは、上図のネットワークの一部だけを構築します。1 つのチャネルで 1 つの順序付けサービスと、ピア組織およびピアを 1 つホストするために使用できるシンプルなネットワークです。 以下の図は、上図のネットワークのうちここで構築する部分を示しています。
![シンプルなネットワーク構造](../images/ibp2-simple-network.svg "シンプルなネットワーク構造")

この構成は、すぐにスマート・コントラクトを開始してテストしたい場合には便利ですが、取引相手になる他の組織を追加して実際に分散したネットワークを作成しないと、あまり意味はありません。 そのため、次の[ネットワーク参加](/docs/services/blockchain/howto?topic=blockchain-ibp-console-join-network#ibp-console-join-network)チュートリアルで、追加のピア組織とピアを作成する方法、および新しい組織をチャネルに追加する方法を説明します。

このチュートリアルでは、全体を通して、コンソールのフィールドの**推奨値**を記載しています。 推奨値を使用すれば、タブやドロップダウン・リストで名前や ID を見つけやすくなります。 これらの値は必須ではありませんが、使用すると便利です。特に、前のステップで入力した登録ユーザーの ID や機密事項といった特定の値を記憶しておく必要がある場合に役立ちます。 これらの値はコンソールに格納されないため、忘れた場合は、追加ユーザーを登録して、プロセスをはじめからやり直す必要があります。 各タスクの後に推奨値の表を示します。推奨値を使用しない場合は、チュートリアルを進めながら、使用する値を記録することをお勧めします。
{:tip}

## 手順 1: ピア組織とピアを作成する
{: #ibp-console-build-network-create-peer-org1}

コンソールを使用して作成する組織ごとに、CA を 1 つ以上デプロイする必要があります。 CA とは、すべてのネットワーク参加者 (ピア、順序付けサービス、クライアント、管理者など) に証明書を発行するノードです。 ネットワーク参加者は、署名証明書および秘密鍵を含むこれらの証明書を使用して通信および認証することができ、最終的にトランザクションを実行できます。 これらの CA により、組織に属するすべての ID および証明書を作成し、さらに組織そのものを定義します。 その後、それらの ID を使用して、ノードのデプロイ、管理者 ID の作成、トランザクションの送信を行えます。 CA および作成する必要がある ID について詳しくは、[ID の管理](/docs/services/blockchain/howto?topic=blockchain-ibp-console-identities#ibp-console-identities)を参照してください。

このチュートリアルでは、組織を 2 つ作成します。ピアを所有する組織と、順序付けサービスを所有する組織です。 どちらの組織にも、その組織の証明書を発行する CA が必要です。そのため、**2 つの CA** を作成する必要があります。 このチュートリアルの目的に合わせて、**ここでは、CA を 1 つだけ作成します**。

以下の[ビデオ](http://ibm.biz/BlockchainPlatformSeries2){: external}を見て、ピアの組織とピアを作成するプロセスを確認してください。


### ピア組織の CA を作成する
{: #ibp-console-build-network-create-CA-org1CA}

このチュートリアルでは、ユーザーおよびノードの証明書鍵と秘密鍵が CA によって発行されます。 それらの ID を、{{site.data.keyword.IBM_notm}} は管理しません。それらの鍵はコンソールにも保管されません。 これらはブラウザーのローカル・ストレージのみに保管されます。 そのため、ID および組織の MSP を必ずエクスポートしてください。 別のマシンや別のブラウザーからコンソールにアクセスする場合は、それらの ID および組織の定義をインポートする必要があります。
{:important}

最初の組織の証明書を発行する CA を作成するには、コンソールで以下の手順を実行します。

1. 左側の**「ノード」**タブにナビゲートし、**「認証局の追加 (Add Certificate Authority)」**をクリックします。 サイド・パネルを使用して、作成する CA をカスタマイズできるとともに、この CA によって鍵が発行される対象となる組織をカスタマイズできます。
2. このチュートリアルではノードを作成するので、認証局を**「作成」**するオプションが選択されていることを確認します。 次に、**「次へ」**をクリックします。
3. 2 つ目のサイド・パネルを使用して、CA に**表示名**を付けます。 この CA にお勧めする値は、`Org1 CA` です。
4. 次のパネルで、**CA 管理者の登録 ID** として `admin` を指定し、機密事項として `adminpw` を指定して、CA 管理者に資格情報を付与します。 この場合も、これらは**推奨値**です。
5. 有料クラスターを使用している場合は、ノードのリソース割り振りを構成できます。 このチュートリアルでは、すべてのデフォルトを受け入れ、**「次へ」**をクリックします。 {{site.data.keyword.cloud_notm}} のリソースをノードに割り振る方法について詳しくは、[リソースの割り振り](/docs/services/blockchain?topic=blockchain-ibp-console-govern#ibp-console-govern-allocate-resources)で該当するトピックを参照してください。 無料クラスターを使用している場合は、**「サマリー」**ページが表示されます。
6. 「サマリー」ページを確認し、**「認証局の追加 (Add Certificate Authority)」**をクリックします。

**タスク: ピア組織の CA の作成**

  | **フィールド** | **表示名** | **登録 ID** | **機密事項** |
  | ------------------------- |-----------|-----------|-----------|
  | **認証局の作成 (Create CA)** | Org1 CA  | admin | adminpw |

  *図 3. ピア組織の CA の作成*

CA をデプロイしたら、組織 MSP の作成、ユーザーの登録、**ピア**の作成を行うときにその CA を使用します。

既に独自の CA を所有している上級ユーザーは、コンソールで CA を新規作成する必要はない可能性があります。 既存の CA が `X.509` 形式の証明書を発行できる場合は、ここで新規 CA を作成せずに、その独自の外部 CA を使用できます。 詳しくは、[外部 CA からの証明書をピアまたは順序付けサービスに使用する](/docs/services/blockchain/howto?topic=blockchain-ibp-console-build-network#ibp-console-build-network-third-party-ca)のトピックを参照してください。

### CA を使用して ID を登録する
{: #ibp-console-build-network-use-CA-org1}

作成するノードまたはアプリケーションごとに、ロックチェーン・ネットワークに参加するための証明書と秘密鍵が必要です。 これらのノードとアプリケーションをコンソールから管理可能にするために、これらのための管理者 ID も作成する必要があります。 このプロセスは、作成した CA ごとに 1 回、合計 2 回行います。 そして CA ごとに、以下の 2 つの ID を作成します。

* **組織管理者**: この ID により、プラットフォーム・コンソールを使用してノードを操作できます。
* **ピア ID**: これはピア自体の ID です。 ピアでは、アクション (例えば、トランザクションの承認) を実行するたびに、証明書を使用して署名します。

クラスターのタイプによっては、CA のデプロイメントに最大 10 分かかることがあります。 CA が初めてデプロイされる場合 (またはその他の理由で CA が使用可能でない場合) は、CA のタイル内のボックスはグレーのボックスになります。 CA が正常にデプロイされ、実行されると、このボックスは緑になり、CA が「実行中」であり、ID の登録に使用できることを示します。 ID を登録する下記の手順を始める前に、CA の状況が「実行中」になるまで待つ必要があります。
{:important}

CA が実行されると (タイルの緑のボックスで示されます)、以下の手順を実行してこれらの証明書が生成されます。

1. `Org1 CA` をクリックし、この CA に作成した `admin` ID が表に表示されていることを確認します。 次に、**「ユーザーの登録」**ボタンをクリックします。
2. まず、組織の管理者を登録します。これには、**「登録 ID」**に `org1admin` を指定し、**「機密事項」**に `org1adminpw` を指定します。 次に、この ID の`「タイプ」`を `client` に設定します (管理者 ID は常に `client` として登録する必要がありますが、ノード ID は常に `peer` タイプを使用して登録する必要があります)。 **「最大登録数」**フィールドは無視してかまいません。 エンロールの詳細については、[アイデンティティーの登録](/docs/services/blockchain/howto?topic=blockchain-ibp-console-identities#ibp-console-identities-register)を参照してください。 **「次へ」**をクリックします。
3. このチュートリアルでは、**「属性の追加 (Add Attribute)」**を使用する必要はありません。 ID 属性の詳細については、[アイデンティティーの登録](/docs/services/blockchain/howto?topic=blockchain-ibp-console-identities#ibp-console-identities-register)を参照してください。
4. 組織管理者を登録したら、ピアの ID に対しても同じプロセスを繰り返します (この場合も `Org1 CA` を使用します)。 ピア ID に、登録 ID として `peer1` を指定し、機密事項として `peer1pw` を指定します。 これはノード ID なので、**「タイプ」**に`ピア`を選択します。 **「最大登録数」**フィールドは無視してかまいません。また、次のパネルでは、先ほどと同様に**「属性 (Attributes)」**を割り当てないでください。

これらの ID を CA に登録することは、ID を**作成**する最初のステップにすぎません。 これらの ID は、**エンロール**されるまでは使用できません。 `org1admin` ID の場合、エンロールは MSP の作成中に行われます。これについて、次の手順で説明します。 ピアの場合は、ピアの作成中にエンロールが行われます。
{:note}

**タスク: ユーザーの登録**

  |  **フィールド** | **説明** | **登録 ID** | **機密事項** |
  | ------------------------- |-----------|-----------|-----------|-----------|
  | **ユーザーの登録** |  Org1 管理者 | org1admin | org1adminpw |
  | | ピア ID |  peer1 | peer1pw |

  *図 4. CA を使用したユーザーの登録*

### ピア組織の MSP 定義を作成する
{: #ibp-console-build-network-create-peers-org1}

ここまでに、ピアの CA を作成し、これを使用して `Org1` 管理者および `Org1` に関連付けるピアの ID を**登録**したので、MSP と呼ばれる、ピアの組織の正式な定義を作成する必要があります。 複数のピアが単一の組織に属することができることに注意してください。 **ピアを作成するたびに新しい組織を作成する必要はありません**。 このチュートリアルを実行するのは今回が初めてであるため、この組織の MSP ID を作成します。 MSP を作成するプロセスの中で、`org1admin` の ID をエンロールし、ウォレットに追加します。

1. 左側ナビゲーションの**「組織」**タブにナビゲートし、**「MSP 定義の作成 (Create MSP definition)」**をクリックします。
2. MSP の表示名に `Org1 MSP` および MSP ID に `org1msp` を指定します。 このフィールドで独自の MSP ID を指定する場合は、ツールチップに表示されるこの名前の制限事項に関する指定内容に従ってください。
3. **「ルート認証局の詳細 (Root Certificate Authority details)」**の下で、前の手順で ID を登録するために使用した CA を指定します。 このチュートリアルを初めて実行する場合には、`Org1 CA` だけが表示されます。
4. これの下の**「登録 ID」**フィールドと**「機密事項の登録」**フィールドには、CA を使用して作成した最初のユーザーの登録 ID と機密事項 (`admin` および `adminpw`) が自動的に入力されます。 ただし、この ID を使用すると、組織の管理者 ID が CA の ID と同じになります。セキュリティー上の理由から、これはお勧めしません。 代わりに、組織管理者用に作成した登録 ID である `org1admin` をドロップダウン・リストから選択し、この ID に関連付けられている機密事項の `org1adminpw` を入力します。 そして、この ID に表示名 `Org1 Admin` を指定します。
5. **「生成 (Generate)」**ボタンをクリックして、このアイデンティティーを組織の管理者として登録して、このアイデンティティーをウォレットにエクスポートします。これは、ピアの作成時やチャネルの作成時に使用されます。
6. **「エクスポート」**をクリックして、管理者の証明書をファイル・システムにエクスポートします。 前述のように、この ID はコンソールに保管されることも {{site.data.keyword.IBM_notm}} によって管理されることもありません。 これはブラウザーのローカル・ストレージのみに保管されます。 ブラウザーを変更する場合は、ピアを管理できるようにするために、この ID をウォレットにインポートする必要があります。
7. **「MSP 定義の作成 (Create MSP definition)」**をクリックします。

**タスク: ピア組織の MSP の作成**

  |  | **表示名** | **MSP ID** | **登録 ID**  | **機密事項** |
  | ------------------------- |-----------|-----------|-----------|-----------|
  | **組織の作成** | Org1 MSP | org1msp |||
  | **ルート CA** | Org1 CA ||||
  | **組織管理者の証明書** | |  | org1admin | org1adminpw |
  | **ID** | Org1 Admin |||||

  *図 5. ピア組織の MSP 定義の作成*

MSP を作成すると、**「ウォレット (Wallet)」**にピア組織管理者が表示されます。ウォレットには、左側のナビゲーションの**「ウォレット (Wallet)」**をクリックしてアクセスできます。

**タスク: ウォレットの確認**

  | **フィールド** |  **表示名** | **説明** |
  | ------------------------- |-----------|----------|
  | **ID** | Org1 Admin | Org1 の管理者 ID |

  *図 6. ウォレットの確認*

MSP について詳しくは、[組織の管理](/docs/services/blockchain/howto?topic=blockchain-ibp-console-organizations#ibp-console-organizations)を参照してください。

これらの証明書の管理および保護はお客様が行う作業ですので、組織管理者 ID をエクスポートすることは大切です。 ブラウザーを切り替える場合、この管理 ID をインポートする必要があります。そうしないと、Org1 を操作できなくなります。
{:important}

### ピアを作成する
{: #ibp-console-build-network-peer-create}

[CA を作成し](/docs/services/blockchain/howto?topic=blockchain-ibp-console-build-network#ibp-console-build-network-create-CA-org1CA)、それを使用して Org1 ID を登録し、[Org1 MSP](/docs/services/blockchain/howto?topic=blockchain-ibp-console-build-network#ibp-console-build-network-create-peers-org1) を作成したら、Org1 用のピアを作成する準備は完了です。

#### ピアの役割
{: #ibp-console-build-network-peer-role}

重要な留意事項として、組織自体が台帳を保守することはありません。 ピアが保守します。 また組織はピアを使用して、トランザクション提案に署名して、チャネル構成の更新を承認します。 チャネル上にピアが組織あたり 2 つ以上存在すると、組織の可用性が高まります。チャネルにピアを組織あたり 3 つ参加させることが、実動レベルの実装のベスト・プラクティスです。これにより、1 つのピアが保守のために停止しているときでも、高可用性が維持されるためです。 ただし、このチュートリアルでは、単一のピアを作成するプロセスだけを説明します。 このプロセスを独自のビジネス・ニーズに合わせて繰り返してください。

リソース割り振りの観点からは、同じピアを複数のチャネルに参加させることが可能です。 ピアの設計上、いずれかのチャネルのデータを、ピアを介して別のチャネルに渡すことができないようになっています。 ただし、ピアにはチャネルごとに別個の台帳が保管されるため、トランザクションとデータの負荷を処理するための十分な処理能力とストレージをピアが備えていることを確認する必要があります。

#### ピアをデプロイする
{: #ibp-console-build-network-deploy-peer-role}

コンソールを使用して以下の手順を実行します。

1. **「ノード」**ページで、**「ピアの追加」**をクリックします。
2. ピアを**作成**するオプションが選択されていることを確認します。 次に、**「次へ」**をクリックします。
3. ピアの**「表示名」**に `Peer Org1` を指定します。 このチュートリアルでは、ピアの外部 CA を使用することを選択しないでください。詳細については、[外部 CA からの証明書の使用](#ibp-console-build-network-third-party-ca)を参照してください。 **「次へ」**をクリックします。
4. 次の画面で、ピア ID を登録するために使用した CA である、`Org1 CA` を選択します。 ピア用に作成したピア ID の**登録 ID** である `peer1` をドロップダウン・リストから選択し、この ID に関連付けられている**機密事項**の `peer1pw` を入力します。 そして、ドロップダウン・リストから `Org1 MSP` を選択し、**「次へ」**をクリックします。
5. 次のサイド・パネルでは、TLS CA 情報が求められます。 CA を作成したときに、TLSCA が一緒に作成されています。 この CA は、ノードのセキュア通信層の証明書を作成するために使用されます。 このため、ピア用に作成したピア ID の**登録 ID** である `peer1` をドロップダウン・リストから選択し、この ID に関連付けられている**機密事項**の `peer1pw` を入力します。 **「TLS Certificate Signing Request ホスト名 (TLS Certificate Signing Request (CSR) hostname)」**は、ピアのエンドポイントのアドレス指定に使用できるカスタム・ドメイン名を指定する上級者用のオプションです。 カスタム・ドメイン名はこのチュートリアルでは扱わないため、ここでは**「TLS CSR ホスト名 (TLS CSR hostname)」**は空白のままにします。
6. 有料クラスターを使用している場合は、次のパネルで、ノードのリソース割り振りを構成できます。 このチュートリアルでは、すべてのデフォルトを受け入れ、**「次へ」**をクリックしてかまいません。 {{site.data.keyword.cloud_notm}} のリソースをノードに割り振る方法について詳しくは、[リソースの割り振り](/docs/services/blockchain?topic=blockchain-ibp-console-govern#ibp-console-govern-allocate-resources)で該当するトピックを参照してください。 無料の {{site.data.keyword.cloud_notm}} クラスターを使用している場合は、**「ID の関連付け (Associate an identity)」**パネルが表示されます。
7. 最後のサイド・パネルでは、**ID を関連付けて**、ピアの管理者にすることを要求されます。 このチュートリアルでは、組織の管理者である `Org1 Admin` をピアの管理者にもします。 `Org1 CA` に異なる ID を登録およびエンロールして、その ID をピアの管理者にすることもできますが、このチュートリアルでは `Org1 Admin` ID を使用します。
8. 要約を確認し、**「ピアの追加」**をクリックします。

**タスク: ピアのデプロイ**

  |  | **表示名** | **MSP ID** | **登録 ID** | **機密事項** |
  | ------------------------- |-----------|-----------|-----------|-----------|
  | **ピアの作成** | Peer Org1 | org1msp |||
  | **CA** | Org1 CA ||||
  | **ピア ID** | |  | peer1 | peer1pw |
  | **管理者証明書** | org1msp ||||
  | **TLS CA** | Org1 CA ||||
  | **TLS CA ID** | || peer1 | peer1pw |
  | **ID の関連付け (Associate identity)** | Org1 Admin |||||

  *図 7. ピアのデプロイ*

実動シナリオでは、組織ごとに各チャネルに 3 つのピアをデプロイすることをお勧めします。 同じ 3 つのピアを複数の異なるチャネルに参加させることも、異なるピアを使用することもできます。 それは組織によって決められます。 これは、1 つのピアがダウンしていても (例えば、保守期間中に)、可用性の高いピアを保持できるようにするためです。 1 つの組織に複数のピアをデプロイするには、最初のピア ID を登録するために使用したものと同じ CA を使用します。 このチュートリアルでは、これは `Org1 CA` です。 次に、個別の登録 ID と機密事項を使用して新しいピア ID を登録します。 例えば、`org1secondpeer` と `org1secondpeerpw` です。 ピアの作成時に、この登録 ID と機密事項を指定します。 このピアはまだ Org1 に関連付けられているため、ドロップダウン・リストから `Org1 CA`、`Org1 MSP`、および `Org1 Admin` を選択します。 この新しいピアに異なる管理者を指定して、`Org1 CA` に登録およびエンロールすることもできますが、これはオプションです。 このチュートリアルのシリーズでは、ピア組織ごとに単一のピアを作成するプロセスのみを説明します。
{:tip}

## 手順 2: 順序付けサービスの作成
{: #ibp-console-build-network-create-orderer}

Ethereum や Bitcoin などの他の分散ブロックチェーンでは、トランザクションを順序付けしてピアに送り出す中央の機関は存在しません。 {{site.data.keyword.blockchainfull_notm}} Platform がベースとするブロックチェーン、Hyperledger Fabric は、他とは異なる動作をします。 これには、**順序付けサービス**と呼ばれる、ノード (または複数のノードのクラスター) が備わっています。

順序付けサービスは、いくつかの必須機能を実行するため、ネットワークのキー・コンポーネントです。

- 台帳に書き込むためにピアに送られるトランザクションのブロックを、文字どおり**順序付け**します。 このプロセスを「順序付け」と呼びます。
- これらは、チャネルの作成を許可されたピア組織のリストである**コンソーシアム**が存在する、**順序付けシステム・チャネル**を維持します。 コンソーシアムは、実質的にはマルチテナンシーの通信手段です。単一の順序付けサービスで複数のコンソーシアムをホストできる設計になっています。
- コンソーシアムまたはチャネル管理者によって決定された**ポリシーを実施**します。 それらのポリシーにより、チャネルの読み書きが可能なユーザーから、チャネルの作成や変更が可能なユーザーまで、あらゆることを指定できます。 例えば、ネットワーク参加者がチャネルまたはコンソーシアム・ポリシーの変更を要求すると、順序付けサービスはその要求を処理して、参加者に構成を更新するための適切な管理権限があるかどうかを確認し、更新内容を既存の構成と比較して検証し、新しい構成を生成してピアに中継します。

順序付けサービスの詳細、およびそれらが Hyperledger Fabric ベースのネットワーク内で果たす役割の詳細については、[The Ordering Service](https://hyperledger-fabric.readthedocs.io/en/release-1.4/orderer/ordering_service.html){: external} を参照してください。

有料クラスターでは、1 つのノードの順序付けサービス (テスト目的では十分です) を作成するか、単一の組織に関連付けられた 5 つのノードを持つ、クラッシュ・フォールト・トレラントの順序付けサービスを作成するかを選択できます。 無料クラスターでは、単一ノードの順序付けサービスしか作成できません。 このチュートリアルでは、5 つのノードの順序付けサービスについて説明します。

ただし、ピアの場合と同様に、順序付けサービスを作成するには、その前に順序付けサービス組織の ID と MSP を提供する CA を作成する必要があります。

以下の[ビデオ](http://ibm.biz/BlockchainPlatformSeries3){: external}を見て、順序付けサービスの組織および順序付けサービスを作成するプロセスを確認してください。

### コンソールでの順序付け
{: #ibp-console-build-network-ordering-console}

このリリースでは、複数の組織が 1 つの順序付けサービスにノードを提供する、分散順序付けサービスはサポートされていません。 順序付けサービスのすべての順序付けノードは、単一の組織によって管理されます。

使用可能な実動レベルの順序付けサービスは、`etcd` での Raft プロトコルの実装に基づくクラッシュ・フォールト・トレラント (CFT) 順序付けサービスです。 Raft は「リーダーとフォロワー」モデルに従います。このモデルでは、リーダー・ノードが (チャネルごとに) 選ばれ、その決定がフォロワーによって複製されます。 Raft の順序付けサービスは、Kafka ベースの順序付けサービスよりも設定と管理が簡単です。また、その設計により、複数の異なる組織が 1 つの分散順序付けサービスにノードを提供できます。 Raft について詳しくは、[The Ordering Service](https://hyperledger-fabric.readthedocs.io/en/release-1.4/orderer/ordering_service.html#raft){: external} を参照してください。

現時点で使用可能な順序付けノードのクラッシュ・フォールト・トレラント構成は、**5 つ**のノードの構成のみです。 3 ノードのみを使用してクラッシュ・フォールト・トレラントの順序付けサービスを作成することも可能ですが、この構成にはリスクがあります。 例えば、保守サイクルなどで 1 ノードがダウンした場合は、2 ノードのみになります。 このサイクル中に**何らかの理由で**ノードがもう 1 つ失われると、1 ノードのみになります。 この状態では、3 ノードで順序付けサービスを開始したのに 1 ノードしかないので、使用可能なノード数が過半数 (「クォーラム」とも呼ばれます) を切ったことになります。 クォーラムがないと、トランザクションをプッシュできません。 そのチャネルは機能しなくなります。

5 つのノードがあれば、2 つのノードを失ってもクォーラムを保持できます。つまり、高可用性を維持した状態で保守サイクルを実行できます。 そのため、有料クラスターの選択肢は、1 つのノードか 5 つのノードのみになります。 1 つのノードの順序付けサービスは、定義上はクラッシュ・フォールト・トレラントではないため、実動ネットワークでは 5 つのノードのオプションを選択する必要があります。

このチュートリアルでは、5 つのノードの順序付けサービスを作成します。

### 順序付けサービス組織の CA を作成する
{: #ibp-console-build-network-create-orderer-ca}

順序付けサービスのために CA を作成するプロセスは、ピアのために作成する場合と同じです。

1. **「ノード」**タブにナビゲートし、**「認証局の追加 (Add Certificate Authority)」**をクリックします。
2. このチュートリアルではノードを作成するので、認証局を**「作成」**するオプションが選択されていることを確認します。 次に、**「次へ」**をクリックします。
3. この CA に固有の表示名 `Ordering Service CA` を指定します。
4. **CA 管理者の登録 ID** である `admin` および機密事項である `adminpw` を再利用できます。 これは異なる CA であるため、ID と機密事項が同一であっても、この ID は `Org1 CA` に対して作成される CA 管理者 ID とは異なります。
5. 有料クラスターを使用している場合は、次のパネルで、CA のリソース割り振りを構成できます。 このチュートリアルでは、すべてのデフォルトを受け入れ、**「次へ」**をクリックします。 {{site.data.keyword.cloud_notm}} のリソースをノードに割り振る方法について詳しくは、[リソースの割り振り](/docs/services/blockchain?topic=blockchain-ibp-console-govern#ibp-console-govern-allocate-resources)で該当するトピックを参照してください。 無料クラスターを使用している場合は、**「サマリー」**ページが表示されます。
6. 「サマリー」ページを確認し、**「認証局の追加 (Add Certificate Authority)」**をクリックします。

ピアの場合と同様に、上級者は既に独自の CA を所有しており、コンソールを使用して CA を新規作成する必要はない場合があります。 既存の CA が `X.509` 形式の証明書を発行できる場合は、ここで新規 CA を作成せずに、その独自の外部 CA を使用できます。 詳しくは、[外部 CA からの証明書をピアまたは順序付けサービスに使用する](/docs/services/blockchain/howto?topic=blockchain-ibp-console-build-network#ibp-console-build-network-third-party-ca)のトピックを参照してください。

### CA を使用して順序付けサービス・ノードおよび順序付けサービス管理者 ID を登録する
{: #ibp-console-build-network-use-CA-orderer}

ピアの場合と同様に、順序付けサービスの CA にも 2 つの ID を登録する必要があります。 CA を選択したら、順序付けサービス組織の管理者および順序付けサービス自体の ID を登録する必要があります。 前と同じく、`「Ordering Service CA」`タブに ID が表示されています。これは、CA のために作成した管理者です。

クラスターのタイプによっては、CA のデプロイメントに最大 10 分かかることがあります。 CA が初めてデプロイされる場合 (またはその他の理由で CA が使用可能でない場合) は、CA のタイル内のボックスはグレーのボックスになります。 CA が正常にデプロイされ、実行されると、このボックスは緑になり、CA が「実行中」であり、ID の登録に使用できることを示します。 ID を登録する下記の手順を始める前に、CA の状況が「実行中」になるまで待つ必要があります。
{:important}

CA が実行されると (`「Ordering Service CA」`のタイルの緑のボックスで示されます)、以下の手順を実行して、これらの証明書が生成されます。

1. **「ノード」**タブで`「Ordering Service CA」`をクリックし、CA 用に作成した `admin` ID が表に表示されていることを確認します。 次に、**「ユーザーの登録」**ボタンをクリックします。
2. まず、組織の管理者を登録します。これには、**「登録 ID」**に `OSadmin` を指定し、**「機密事項」**に `OSadminpw` を指定します。 次に、この ID の`「タイプ」`を `client` に設定します (管理者 ID は常に `client` として登録する必要がありますが、ノード ID は常に `peer` タイプを使用して登録する必要があります)。 **「最大登録数」**フィールドは無視してかまいません。 エンロールの詳細については、[アイデンティティーの登録](/docs/services/blockchain/howto?topic=blockchain-ibp-console-identities#ibp-console-identities-register)を参照してください。 **「次へ」**をクリックします。
3. このチュートリアルでは、**「属性の追加 (Add Attribute)」**を使用する必要はありません。 ID 属性の詳細については、[アイデンティティーの登録](/docs/services/blockchain/howto?topic=blockchain-ibp-console-identities#ibp-console-identities-register)を参照してください。
4. 組織管理者を登録したら、順序付けサービスの ID に対しても同じプロセスを繰り返します (この場合も `Ordering Service CA` を使用します)。 順序付けサービス・ノード ID に、登録 ID として `OS1` を指定し、機密事項として `OS1pw` を指定します。 これはノード ID なので、**「タイプ」**に`ピア`を選択します。 **「最大登録数」**フィールドは無視してかまいません。また、次のパネルでは、先ほどと同様に**「属性 (Attributes)」**を割り当てないでください。

**タスク: CA の作成およびユーザーの登録**

  | **フィールド** | **説明** | **登録 ID** | **機密事項** |
  | ------------------------- |-----------|-----------|-----------|-----------|
  | **認証局の作成 (Create CA)** | 順序付けサービス CA | admin | adminpw |
  | **ユーザーの登録** | 順序付けサービス管理者 | OSadmin | OSadminpw |
  |  | 順序付けサービス・ノード ID |  OS1 | OS1pw |

*図 8. CA の作成およびユーザーの登録*

このチュートリアルでは、ノード ID を 1 つのみ作成します。 この ID は、順序付けサービスを作成するためにデプロイする 5 つのノードすべてで使用されます。 これは複数組織の順序付けサービスでは推奨されませんが、すべての順序付けノードが同じ組織によって所有されていれば問題はありません。

### 順序付けサービス組織の MSP 定義を作成する
{: #ibp-console-build-network-create-orderer-org-msp}

順序付けサービス組織の MSP 定義を作成し、組織の管理者 ID を指定します。 順序付けサービスの管理者とユーザーを登録したら、MSP ID を作成し、組織の管理者として登録した `OSadmin` ユーザーをエンロールする必要があります。

1. 左側ナビゲーションの**「組織」**タブにナビゲートし、**「MSP 定義の作成 (Create MSP definition)」**をクリックします。
2. MSP 定義の表示名に `Ordering Service MSP` を指定し、MSP ID に `osmsp` を指定します。 異なる MSP ID を選択する場合は、ツールチップに表示されるこの名前の制限事項に関する指定内容に従ってください。
3. **「ルート認証局の詳細 (Root Certificate Authority details)」**の下で、作成した `Ordering Service CA` を選択します。
4. これの下の**「登録 ID」**フィールドと**「機密事項の登録」**フィールドには、CA を使用して作成した最初のユーザーの登録 ID と機密事項 (`admin` および `adminpw`) が自動的に入力されます。 ただし、この ID を使用すると、組織の ID が CA の ID と同じになります。セキュリティー上の理由から、これは推奨されません。 代わりに、組織管理者用に作成した登録 ID である `OSadmin` をドロップダウン・リストから選択し、この ID に関連付けられている機密事項の `OSadminpw` を入力します。 そして、この ID に表示名 `Ordering Service Admin` を指定します。
5. **「生成 (Generate)」**ボタンをクリックして、この ID を組織の管理者としてエンロールし、ウォレットに ID をエクスポートします。
6. **「エクスポート」**をクリックして、管理者の証明書をファイル・システムにエクスポートします。 前述のように、この ID はコンソールに保管されることも {{site.data.keyword.IBM_notm}} によって管理されることもありません。 これはブラウザー内にのみ保管されます。 ブラウザーを変更する場合は、順序付けサービスを管理できるようにするために、この ID をインポートする必要があります。
7. **「MSP 定義の作成 (Create MSP definition)」**をクリックします。

**タスク: 順序付けサービス組織の MSP 定義の作成**

  |  | **表示名** | **MSP ID** | **登録 ID**  | **機密事項** |
  | ------------------------- |-----------|-----------|-----------|-----------|
  | **組織の作成** | 順序付けサービス MSP | osmsp |||
  | **ルート CA** | 順序付けサービス CA ||||
  | **組織管理者の証明書** | |  | OSadmin | OSadminpw |
  | **ID** | 順序付けサービス管理者 |||||

  *図 9. 順序付けサービス組織の MSP 定義の作成*

MSP を作成すると、**「ウォレット (Wallet)」**に順序付けサービス組織管理者が表示されます。ウォレットには、左側のナビゲーションの**「ウォレット (Wallet)」**をクリックしてアクセスできます。

**タスク: ウォレットの確認**

  | **フィールド** |  **表示名** | **説明** |
  | ------------------------- |-----------|----------|
  | **ID** | Org1 Admin | Org1 の管理者 ID |
  | **ID** | 順序付けサービス管理者 | 順序付けサービスの管理者 ID |

  *図 10. 順序付けサービス組織の MSP 定義の作成*

MSP について詳しくは、[組織の管理](/docs/services/blockchain/howto?topic=blockchain-ibp-console-organizations#ibp-console-organizations)を参照してください。

これらの証明書の管理および保護はお客様が行う作業ですので、組織管理者 ID をエクスポートすることは大切です。 順序付けサービスおよび順序付けサービスの MSP 定義をエクスポートすれば、それらを別のコンソールにインポートできます。そうすれば、そのコンソールで別のオペレーターが順序付けサービスに新しいチャネルを作成したり、チャネルにピアを参加させたりできるようになります。
{:important}

### 順序付けノードのデプロイ
{: #ibp-console-build-network-create-an-orderer}

コンソールから以下の手順を実行します。

1. **「ノード」**ページで、**「順序付けサービスの追加 (Add ordering service)」**をクリックします。
2. 順序付けサービスを**「作成」**するオプションが選択されていることを確認します。 次に、**「次へ」**をクリックします。
3. 順序付けサービスの**「表示名」**に `Ordering Service` を指定します。有料クラスターの場合は、順序付けサービスに 1 つのノード (テストには十分です) を含めるか、5 つのノード (実動に適しています) を含めるかを選択します。 **「5 ノード (five nodes)」**を選択します。 また、外部 CA を使用することは選択しないでください。 これは拡張オプションです。 このチュートリアルでは、順序付けサービスの外部 CA を使用することを選択しないでください。詳細については、[外部 CA からの証明書の使用](#ibp-console-build-network-third-party-ca)を参照してください。 **「次へ」**をクリックします。
4. 次のパネルで、`Ordering Service CA` を CA として選択します。 次に、順序付けサービス用に作成したノード ID の**登録 ID** である `OS1` をドロップダウン・リストから選択し、この ID に関連付けられている**機密事項**の `OS1pw` を入力します。 続けて、ドロップダウン・リストから、ご使用の MSP である `Ordering Service MSP` を選択します。
5. 次のサイド・パネルでは、TLS CA 情報が求められます。 CA を作成したときに、TLS CA が一緒に作成されています。 この CA は、ノードのセキュア通信層の証明書を作成するために使用されます。 そのため、作成した順序付けサービス ID の**登録 ID** である `OS1` をドロップダウン・リストから選択し、この ID に関連付けられている**機密事項**の `OS1pw` を入力します。 **「TLS Certificate Signing Request (CSR) ホスト名 (TLS Certificate Signing Request (CSR) hostname)」**は、順序付けサービスのエンドポイントのアドレス指定に使用できるカスタム・ドメイン名を指定する上級者用のオプションです。 カスタム・ドメイン名はこのチュートリアルでは扱わないため、ここでは**「TLS CSR ホスト名 (TLS CSR hostname)」**は空白のままにします。
6. 有料クラスターを使用している場合は、次のパネルで、ノードのリソース割り振りを構成できます。 このチュートリアルでは、すべてのデフォルトを受け入れ、**「次へ」**をクリックしてかまいません。 ここで選択した内容は、5 つの順序付けノードすべてに適用されます。 {{site.data.keyword.cloud_notm}} のリソースをノードに割り振る方法について詳しくは、[リソースの割り振り](/docs/services/blockchain?topic=blockchain-ibp-console-govern#ibp-console-govern-allocate-resources)で該当するトピックを参照してください。
7. **「ID の関連付け (Associate identity)」**のステップでは、順序付けサービスの管理者を選択できます。 前と同じく `Ordering Service Admin` を選択し、**「次へ」**をクリックします。
8. 「サマリー」ページを確認し、**「順序付けサービスの追加 (Add ordering service)」**をクリックします。

**タスク: 順序付けサービスの作成**

  |  | **表示名** | **MSP ID** | **登録 ID** | **機密事項** |
  | ------------------------- |-----------|-----------|-----------|-----------|
  | **順序付けサービスの作成 (Create ordering service)** | 順序付けサービス | osmsp |||
  | **CA** | 順序付けサービス CA ||||
  | **順序付けサービス ID (Ordering Service Identity)** | |  | OS1 | OS1pw |
  | **管理者証明書** | 順序付けサービス MSP ||||
  | **TLS CA** | 順序付けサービス CA ||||
  | **TLS CA ID** | || OS1 | OS1pw |
  | **ID の関連付け (Associate identity)** | 順序付けサービス管理者 |||||

  *図 11. 順序付けサービスの作成*

順序付けサービスが作成されると、**「ノード」**パネルに表示されます。

## ステップ 3: 順序付けサービスによってホストされるコンソーシアムに参加する
{: #ibp-console-build-network-add-org}

前述のとおり、ピア組織がチャネルを作成したり、チャネルに参加したりするには、ピア組織が順序付けサービスに認識されている必要があります (これを、順序付けサービスに認識されている組織のリストである「コンソーシアム」に参加するとも言います)。 技術的なレベルで言うと、チャネルは、順序付けサービスを介してピア間をつなぐ**メッセージング・パス**であるからです。 チャネル間で情報を受け渡しすることなく、単一のピアを複数のチャネルに参加させることができるのと同様に、単一の順序付けサービスは他のチャネル上の組織にデータを公開することなく、その順序付けサービスを通過する複数のチャネルを持つことができます。

順序付けサービス管理者のみがピア組織をコンソーシアムに追加できるため、順序付けサービス管理者に**なる**か、MSP 情報を順序付けサービス管理者に**送信**することが必要になります。

以下の[ビデオ](http://ibm.biz/BlockchainPlatformSeries4){: external}を見て、組織をコンソーシアムに追加し、チャネルを作成し、そのチャネルにピアを参加させるプロセスを確認してください。

既にコンソールを使用して順序付けサービスの管理者を作成しているため、このプロセスは比較的単純です。
1. **「ノード」**タブにナビゲートします。
2. 作成した順序付けサービスにスクロールダウンし、クリックして開きます。
3. **「コンソーシアム・メンバー (Consortium Members)」**の下の**「組織の追加 (Add Organization)」**をクリックします。
4. ドロップダウン・リストから、`Org1 MSP` を選択します。これはピアの組織 `Org1` を表す MSP であるからです。
5. **「組織の追加」**をクリックします。

このプロセスが完了したら、`Org1` は `Ordering Service` 上でホストされるチャネルを作成、またはチャネルに参加できるようになります。

このチュートリアルでは、ピア組織と順序付けサービス組織の両方を同じコンソールで作成したので、`Org1 MSP` に簡単にアクセスできます。 実動シナリオでは、それぞれのネットワーク・オペレーターが、各自のクラスター内で、各自の {{site.data.keyword.blockchainfull_notm}} コンソールを使用して、その他の組織の MSP 定義を作成することになります。 このような場合に、組織がコンソーシアムに参加するには、組織の MSP 定義を帯域外操作でコンソールに送信する必要があります。 また、順序付けサービスをエクスポートして組織に送信して、組織が自分のコンソールに順序付けサービスをインポートし、ピアをチャネルに参加させる (または新しいチャネルを作成する) ことができるようにする必要もあります。 このプロセスについては、ネットワーク参加チュートリアルの[組織情報のエクスポート](/docs/services/blockchain/howto?topic=blockchain-ibp-console-join-network#ibp-console-join-network-add-org2-remote)の下で説明しています。

## 手順 4: チャネルを作成する
{: #ibp-console-build-network-create-channel}

チャネルの更新方法については、[チャネル構成の更新](/docs/services/blockchain/howto?topic=blockchain-ibp-console-govern#ibp-console-govern-update-channel)を参照してください。

通常、ネットワークのメンバーは、互いに取引することを求めている関連ビジネス組織ですが、他のメンバーに知られずに取引したいというメンバーが存在する場合もあります。 これは、そのようなトランザクションを行うための**チャネル**を作成することで実現できます。 チャネルは、メンバー、ピア、順序付けサービス、台帳、ポリシー、およびスマート・コントラクトを含むという点で、ブロックチェーン・ネットワークの構造と同じです。 しかし、メンバーシップを制限し、時によってはチャネルの認識さえも一部のネットワーク・メンバーシップに制限すれば、必要に応じてプライバシーを維持しながら、ネットワーク・メンバーがネットワークの構造全体を利用できる状態を確保できます。

前述のように、`Org1` のピアをチャネルに参加させるには、まず `Org1` をコンソーシアムに追加する必要があります。 組織がチャネル作成時のコンソーシアム・メンバーでない場合は、チャネルを作成し、該当するチャネルのページの**「設定」**ボタンをクリックし、**「チャネルの更新 (Update Channel)」**フローを実行することで、後から組織を追加できます。

チャネルとその使用方法について詳しくは、[Hyperledger Fabric の資料](https://hyperledger-fabric.readthedocs.io/en/release-1.4/channels.html){: external}を参照してください。

上のビデオ 3 を見て、チャネルを作成してそのチャネルにピアを参加させるプロセスを確認してください。


<!--
Note that even though the {{site.data.keyword.blockchainfull_notm}} Platform 2.0 uses Hyperledger Fabric v1.4 binaries, because the [gossip protocol](https://hyperledger-fabric.readthedocs.io/en/release-1.4/gossip.html){: external} is not being used with the console, Fabric functionalities that leverage gossip, such as [Private Data](https://hyperledger-fabric.readthedocs.io/en/release-1.4/private-data/private-data.html){: external} and [Service Discovery](https://hyperledger-fabric.readthedocs.io/en/release-1.4/discovery-overview.html){: external}, are not available.
-->

### チャネル `channel1` を作成する
{: #ibp-console-build-network-create-channel1}

コンソールは、ピアを使用して、ピアが属するチャネルについての情報を収集するので、**組織がピアをチャネルに参加させていなければ、コンソールはチャネルと対話できません**。

CA、ID、MSP、順序付けサービス、およびピアを作成して、ピア組織をコンソーシアムに追加したら、左側のナビゲーションにある**「チャネル」**タブにナビゲートします。 ここでチャネルの作成と管理を行います。

このタブは初めてナビゲートしたときには空の状態です。**「チャネルの作成」**ボタンと**「チャネルに参加 (Join channel)」**ボタンがあるだけです。 なぜなら、まだチャネルを作成してもいなければ、チャネルにピアを参加させてもいないからです。

#### チャネルを作成する
{: #ibp-console-build-network-channels-create}

コンソールから以下の手順を実行します。

1. **「チャネル」**タブにナビゲートします。
2. **「チャネルの作成」**をクリックします。 サイド・パネルが開きます。
3. チャネルの**名前**に `channel1` を指定します。 この値は、このチャネルに参加する人と共有する必要があるため、メモしておいてください。
4. ドロップダウン・リストから `Ordering Service` を選択します。
5. このチャネルに属する**「組織」**を選択します。 作成した組織は 1 つのみであるため、これは `Org1 MSP (org1msp)` になります。 この組織を**「オペレーター」**にします。 注記: ここでは `Ordering Service MSP` を使用しないでください。
6. チャネルの**「チャネル更新ポリシー (Channel update policy)」**を選択します。 これは、チャネル構成の更新を承認する必要がある組織の数を指定するポリシーです。 このチュートリアルでは単一の組織しか作成しないため、このポリシーは `1 out of 1` にする必要があります。チャネルに組織を追加したら、ユース・ケースのニーズを反映するようにこのポリシーを変更する必要があります。 妥当な標準は、組織の大多数を使用することです。 例えば、`3 out of 5` とします。
7. 適用する**「アクセス制御」**の制限を指定します。 注意: これは**拡張オプション**です。 あるリソースへのアクセス権限を特定の組織に対して設定した場合、チャネル内のその他の組織は、そのリソースへのアクセスを禁止されます。 例えば、すべての組織について、特定のリソースへのデフォルトのアクセス権限が `Readers` の場合に、`Org1` のこのアクセス権限を `Admin` に変更すると、Org1 の管理者**のみ**がそのリソースにアクセスできるようになります。 特定のリソースに対するアクセス権限はチャネルの円滑な操作の基本であるため、アクセス制御に関する決定は慎重に行うことを強くお勧めします。 リソースに対するアクセスを制限することを決定した場合は、必要に応じて、各組織にそのリソースへのアクセス権限が追加されていることを確認してください。
8. **「チャネル作成者の組織 (Channel creator organization)」**を選択します。 コンソールでは、単一のユーザーが複数の組織を所有することが許可されるため、チャネルを作成する組織を指定する必要があります。 このチュートリアルでは、単一の組織のみを作成するため、ドロップダウン・リストから `Org1 MSP` (org1msp) を選択します。 同様に、チャネルを作成する ID として `Org1 Admin` を選択します。

準備ができたら、**「チャネルの作成」**をクリックします。 **「チャネル」**タブに戻り、作成したチャネルの処理中のタイルが表示されます。

**タスク: チャネルの作成**

  |  **フィールド** | **名前** |
  | ------------------------- |-----------|
  | **チャネル名 (Channel name)** | channel1 |
  | **順序付けサービス (Ordering Service)** | 順序付けサービス |
  | **組織** | Org1 MSP |
  | **チャネル更新ポリシー (Channel update policy)** | 1 out of 1 |
  | **アクセス制御リスト** | なし |
  | **チャネル作成者の組織 (Channel creator organization)** | Org1 MSP |
  | **ウォレット ID (Wallet identity)** | Org1 Admin|

*図 12. チャネルの作成*

次の手順では、ピアをこのチャネルに参加させます。

## 手順 5: チャネルにピアを参加させる
{: #ibp-console-build-network-join-peer}

チュートリアルの完了までもう少しです。 チャネルにピアを参加させるのが、ネットワークの基本的なインフラストラクチャーをセットアップするための最後の手順です。 まだこの場所にアクセスしていない場合は、左側のナビゲーションで**「チャネル」**タブにナビゲートします。

コンソールから以下の手順を実行します。

1. `channel1` の処理中のタイルをクリックして、サイド・パネルを立ち上げます。
2. チャネルに参加させるピアを選択します。 このチュートリアルの目的に合わせて、`Peer Org1` をクリックします。
3. **「チャネルへの参加 (Join channel)」**をクリックします。

## 次のステップ
{: #ibp-console-build-network-next-steps}

チャネルを作成し、チャネルにピアを参加させたので、基本的ではありますが正常に機能するブロックチェーン・ネットワークが完成しました。 以下の手順を使用して、スマート・コントラクトをデプロイし、トランザクションの送信を開始できます。

- コンソールを使用して[ネットワークにスマート・コントラクトをデプロイします](/docs/services/blockchain/howto?topic=blockchain-ibp-console-smart-contracts#ibp-console-smart-contracts)。
- スマート・コントラクトをインストールしてインスタンス化すると、[クライアント・アプリケーションを使用してトランザクションを送信](/docs/services/blockchain/howto?topic=blockchain-ibp-console-smart-contracts#ibp-console-smart-contracts-connect-to-SDK)できます。
- [コマーシャル・ペーパーのサンプル](/docs/services/blockchain/howto?topic=blockchain-ibp-console-app#ibp-console-app-commercial-paper)を使用してスマート・コントラクトのサンプルをデプロイし、サンプル・アプリケーション・コードを使用してトランザクションを送信します。

[ネットワーク参加チュートリアル](/docs/services/blockchain/howto?topic=blockchain-ibp-console-join-network#ibp-console-join-network-structure)を使用して、別のピア組織を作成することもできます。 チャネルに 2 つ目の組織を追加して、2 つのピアが単一のチャネル台帳を共有する分散ネットワークをシミュレートすることもできます。

## 外部 CA からの証明書をピアまたは順序付けサービスに使用する
{: #ibp-console-build-network-third-party-ca}

ピアまたは順序付けサービスの CA として、{{site.data.keyword.blockchainfull_notm}} Platform の認証局を使用する代わりに、外部の CA ({{site.data.keyword.IBM_notm}} がホストする CA ではないもの) の証明書を使用できます。ただし、[X.509](https://hyperledger-fabric.readthedocs.io/en/release-1.4/identity/identity.html#digital-certificates){: external} 形式の証明書を発行する CA でなければなりません。

### 始めに
{: #ibp-console-build-network-third-party-ca-prereq}

1. 以下の証明書情報を集め、コンソールにアップロードできるファイルとして個々に保存する必要があります。   
**注:** ファイル内の証明書は、`PEM` 形式でも `base64 エンコード`形式でもかまいません。
 * **ピアまたは順序付けサービスの ID の証明書** これは、このピアまたは順序付けサービス用に外部 CA で作成された署名証明書です。
 * **ピアまたは順序付けサービスの ID の秘密鍵**  これは、このピアまたは順序付けサービス用にサード・パーティー CA で作成された署名付き証明書に対応する秘密鍵です。
 * **ピア組織または順序付けサービス組織の MSP 定義** [MSP の JSON ファイルの手動作成](/docs/services/blockchain/howto?topic=blockchain-ibp-console-organizations#console-organizations-build-msp)に記載している手順を使用して、このファイルを手動で生成する必要があります。
 * **TLS CA 証明書** これは、このピアまたは順序付けサービス用に外部 TLS CA で作成された公開署名証明書です。
  * **TLS CA 秘密鍵** これは、ネットワークの他のメンバーとセキュアな通信を行うために、このピアまたは順序付けサービス用に TLS CA で作成された署名付き証明書に対応する秘密鍵です。
 * **TLS CA ルート証明書** (オプション) これは、外部 TLS CA のルート証明書です。 TLS CA ルート証明書または中間 TLS CA 証明書のいずれかを指定する必要があります。その両方を指定することもできます。
 * **中間 TLS 証明書**: (オプション) これは、TLS 証明書が中間 TLS CA から発行されたものである場合に必要な中間 TLS 証明書です。 中間 TLS CA 証明書をアップロードします。 TLS CA ルート証明書または中間 TLS CA 証明書のいずれかを指定する必要があります。その両方を指定することもできます。
 * **ピアまたは順序付けサービスの管理者 ID の証明書** これは、このピアまたは順序付けサービスの管理者 ID 用に外部 CA で作成された署名証明書です。 この証明書は、ピアまたは順序付けサービスの管理者 ID 鍵とも呼ばれます。
 * **ピアまたは順序付けサービスの管理者 ID の秘密鍵** これは、このピアまたは順序付けサービスの管理者 ID 用に外部 CA で作成された署名付き証明書に対応する秘密鍵です。

2. **「組織」**タブ、**「MSP 定義のインポート (Import MSP definition)」**の順にクリックして、生成したピアまたは順序付けサービス組織用の MSP 定義ファイルをコンソールにインポートします。

ここでは、ピアまたは単一ノードの順序付けサービス・ノードを作成するか、有料クラスターを使用している場合は、5 つのノードの順序付けサービスを作成するかを選択できます。

### オプション 1: 外部 CA からの証明書を使用してピアまたは単一ノードの順序付けサービスを新規作成する
{: #ibp-console-build-network-create-peer-orderer-third-party-ca-}

5 つのノードの順序付けサービスを新規作成する場合は、**オプション 2** にスキップできます。 以下の手順は、外部 CA からの証明書を使用してピアまたは単一ノードの順序付けサービスを作成する場合にのみ使用できます。
{:note}

必要な証明書をすべて収集したので、これらの証明書を使用するピアまたは順序付けサービスを作成できます。 以下の手順に従って、外部 CA からの証明書を使用して、ピアまたは単一ノードの順序付けサービスを作成します。

1. **「ノード」**タブで、**「ピアの追加」**または**「順序付けサービスの追加 (Add ordering service)」**をクリックします。
2. ノードの表示名を入力した後に、外部 CA を使用するためのオプションを選択します。
3. パネルに沿って、集めた証明書情報に対応するファイルをアップロードしていきます。
4. コンソールにインポートしたピア組織または順序付けサービス組織の MSP 定義を、ドロップダウン・リストから選択します。
5. 最後の段階で、ピアまたは順序付けサービスに ID を関連付けることを求められたら、**「新規アイデンティティー (New identity)」**をクリックする必要があります。
6. この ID の**「表示名」**として任意の値を指定します。 この表示名が、ノードを作成した後にウォレットに表示されます。
7. **「証明書」**フィールドで、**ピアまたは順序付けサービスの管理者 ID の証明書**を含むファイルをアップロードします。
8. **「秘密鍵」**フィールドで、**ピアまたは順序付けサービスの管理者 ID の秘密鍵**を含むファイルをアップロードします。
9. 「サマリー」ページの情報を確認し、**「ピアの追加」**または**「順序付けサービスの追加 (Add ordering service)」**をクリックします。

### オプション 2: 外部 CA からの証明書を使用して 5 つのノードの順序付けサービスを作成する
{: #ibp-console-build-network-create-five-node}

有料の {{site.data.keyword.cloud_notm}} Kubernetes Service クラスターを使用する場合、または {{site.data.keyword.cloud_notm}} Private を使用して別のクラウド・プロバイダーでホストするクラスターを使用する場合は、Raft コンセンサス・プロトコルを使用する 5 ノードの順序付けサービスをデプロイする追加オプションを選択できます。  5 ノードの順序付けサービスをデプロイする前に、以下の手順で 5 ノードの証明書をすべて含む JSON ファイルを作成する必要があります。

#### 証明書 JSON ファイルを作成する
{: #ibp-console-build-network-create-certs-file}

必要な証明書 JSON ファイルには、5 つの `msp` エントリーの配列が含まれています。この各配列エレメントに、いずれかの順序付けノードの証明書が含まれています。  ノードごとに固有の証明書を指定する必要があります。異なる順序付けノード間で証明書を再使用しないでください。 `component` セクションの証明書はノード自体の証明書を表し、`tls` セクションには TLS CA によって発行される証明書が含まれています。  

- **keystore**: このノードの秘密鍵
- **signcerts**: このノードに対して CA が割り当てる公開鍵 (署名証明書またはエンロールメント証明書とも呼ばれます)。
- **cacerts**: ルート CA の証明書。
- **admincerts**: ノードの管理者ユーザーの証明書。 これは、組織の管理者でもある場合があります。
- **intermediatecerts**: ネットワークに複数レベルの CA が含まれている場合に、中間 CA の証明書に貼り付けます。 中間証明書を使用していない場合は、このフィールドはブランクのままでかまいません。

上記で収集した証明書を使用して、以下のフィールドに、対応する証明書を base64 形式で貼り付けます。

`PEM` 形式の証明書ファイル `<cert.pem>` の内容を base64 ストリングに変換するには、ローカル・マシンで次のコマンドを実行します。

```
export FLAG=$(if [ "$(uname -s)" == "Linux" ]; then echo "-w 0"; else echo "-b 0"; fi)
cat <cert.pem> | base64 $FLAG
```
{:codeblock}

```
[
    {
        "msp": {
            "component": {
                "keystore": [“<cert>“],
                "signcerts": [“<cert>“],
                "cacerts": [“<cert>“],
                "admincerts": [“<cert>“],
                "intermediatecerts": [“<cert>“]
            },
		"tls": {
                "keystore": [“<cert>“],
                "signcerts": [“<cert>“],
                "cacerts": [“<cert>“],
                "intermediatecerts": [“<cert>“]
            }
        }
    },
    {
        "msp": {
            "component": {
                "keystore": [“<cert>“],
                "signcerts": [“<cert>“],
                "cacerts": [“<cert>“],
                "admincerts": [“<cert>“],
                "intermediatecerts": [“<cert>“]
            },
		"tls": {
                "keystore": [“<cert>“],
                "signcerts": [“<cert>“],
                "cacerts": [“<cert>“],
                "intermediatecerts": [“<cert>“]
            }
        }
    },
    {
        "msp": {
            "component": {
                "keystore": [“<cert>“],
                "signcerts": [“<cert>“],
                "cacerts": [“<cert>“],
                "admincerts": [“<cert>“],
                "intermediatecerts": [“<cert>“]
            },
		"tls": {
                "keystore": [“<cert>“],
                "signcerts": [“<cert>“],
                "cacerts": [“<cert>“],
                "intermediatecerts": [“<cert>“]
            }
        }
    },
    {
        "msp": {
            "component": {
                "keystore": [“<cert>“],
                "signcerts": [“<cert>“],
                "cacerts": [“<cert>“],
                "admincerts": [“<cert>“],
                "intermediatecerts": [“<cert>“]
            },
		"tls": {
                "keystore": [“<cert>“],
                "signcerts": [“<cert>“],
                "cacerts": [“<cert>“],
                "intermediatecerts": [“<cert>“]
            }
        }
    },
    {
        "msp": {
            "component": {
                "keystore": [“<cert>“],
                "signcerts": [“<cert>“],
                "cacerts": [“<cert>“],
                "admincerts": [“<cert>“],
                "intermediatecerts": [“<cert>“]
            },
		"tls": {
                "keystore": [“<cert>“],
                "signcerts": [“<cert>“],
                "cacerts": [“<cert>“],
                "intermediatecerts": [“<cert>“]
            }
        }
    }
]
```
{:codeblock}

この定義を `JSON` ファイルとして保存します。

#### 順序付けサービスを作成し、各順序付けノードの外部 CA からの証明書を使用する
{: #ibp-console-build-network-create-five-node-os}

これで、順序付けノードのすべての証明書を含む JSON ファイルが作成されたので、順序付けサービスを作成できます。

1. **「ノード」**タブで、**「順序付けサービスの追加 (Add ordering service)」**をクリックします。
2. 5 つの順序付けノードに単一の**「表示名」**を入力します。 入力した表示名は、各順序付けノード名のプレフィックスとなり、そこに数値が付加されます。
3. **「順序付けノードの数 (Number of ordering nodes)」**で、**「5 つの順序付けノード (Five ordering nodes)」**を選択します。
4. **「外部認証局からの証明書を使用する (I want to use certificates from an external Certificate Authority)」**を選択し、**「次へ」**をクリックします。
5. **「ファイルの追加 (Add file)」**をクリックして、すべての証明書を含む JSON ファイルをアップロードします。
6. インポートした**「組織 MSP (Organization MSP)」**定義を選択します。
7. 有料クラスターを使用しているため、次のパネルで、ノードのリソース割り振りを構成できます。 ここで選択した内容は、5 つの順序付けノードすべてに適用されます。  リソースをノードに割り振る方法について詳しくは、[リソースの割り振り](/docs/services/blockchain?topic=blockchain-ibp-console-govern#ibp-console-govern-allocate-resources)のトピックを参照してください。
8. サマリーを確認し、**「順序付けサービスの追加 (Add ordering service)」**をクリックします。

### 次の作業
{: #ibp-console-build-network-third-party-ca-next}

サード・パーティー CA で作成されたピアまたは順序付けサービスの証明書をすべて集め、対応する組織 MSP 定義を作成し、ピアまたは順序付けサービスを作成しました。 チュートリアルに沿って進めている場合は、次の手順に戻ることができます。
- ピア・ノードを作成した場合、次の手順は[トランザクションを順序付けするノードを作成する](/docs/services/blockchain/howto?topic=blockchain-ibp-console-build-network#ibp-console-build-network-create-orderer)です。
- 既存のネットワークに参加するためのノードを作成した場合、次の手順は[取引できる組織のリストに組織を追加する](/docs/services/blockchain/howto?topic=blockchain-ibp-console-join-network#ibp-console-join-network-add-org2)です。
- 順序付けサービスを作成した場合、次の手順は[チャネルを作成する](/docs/services/blockchain/howto?topic=blockchain-ibp-console-build-network#ibp-console-build-network-create-channel)です。
