---

copyright:
  years: 2017, 2018
lastupdated: "2018-06-14"
---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:codeblock: .codeblock}
{:screen: .screen}
{:pre: .pre}

# チェーンコードのインストール、インスタンス化、および更新

チェーンコードとは Go、Java、または Node.js で記述されたソフトウェアで、台帳内の資産を作成して変更するためのビジネス・ロジックとトランザクション命令がカプセル化されています。 チェーンコードは、これと対話する必要のある任意のピアに関連付けられた Docker コンテナーで実行されます。  チェーンコードの開発方法について詳しくは、[Chaincode Tutorials ![外部リンク・アイコン](../images/external_link.svg "外部リンク・アイコン")](http://hyperledger-fabric.readthedocs.io/en/latest/chaincode.html) を参照してください。
{:shortdesc}

チェーンコードは、ピアのファイル・システムにインストールされてから、チャネルでインスタンス化されます。 **すべてのチャネル・メンバーは、このチェーンコードを実行するすべてのピアにチェーンコードをインストールする必要があります。** チャネル・メンバーが同じチェーンコードを使用するには、チェーンコードのインストール時に、チェーンコードに対して同じ名前とバージョンを指定する必要があります。 その後のインスタンス化の手順には、キー値ペアの初期化とチェーンコード・コンテナーのデプロイメントが含まれます。 アプリケーションがチェーンコードと対話する際に経由するすべてのピアには、ピアのファイル・システム上にインストールされたチェーンコードと、実行中のチェーンコード・コンテナーが必要です。 **ただし、ピアが複数のチャネルで同じチェーンコードを使用する場合も、必要なチェーンコード・コンテナーのインスタンスは 1 つだけです**。

**インストールとインスタンス化の組み合わせ**は強力な機能です。これにより、ピアは複数のチャネルで同じチェーンコード・コンテナーと対話できるからです。 前提条件は、ピアのファイル・システムに実際のチェーンコードのソース・ファイルをインストールことのみです。 そのため、共通のチェーンコードの断片が数十個のチャネルにわたって使用されている場合でも、ピアがすべてのチャネル台帳で読み取り/書き込みを実行するために必要なチェーンコード・コンテナーの数は 1 つのみです。 ネットワークが拡大してチェーンコードがより複雑化していけば、この軽量なアプローチが計算のパフォーマンスおよびスループットの面で有効であることが明らかになります。

**注**: チェーンコードを対話的な方法で作成し、チェーンコードを更新する必要がある場合は、そのチェーンコードのインストールとインスタンス化の両方の手順を繰り返す必要があります。


## チェーンコードのインストール
{: #installchaincode}

このチェーンコードを実行するすべてのピアにチェーンコードをインストールする必要があります。 以下の手順を実行して、チェーンコードをインストールします。
1. ネットワーク・モニターの「コードのインストール (Install Code) 」画面で、チェーンコードのインストール先のピアをドロップダウン・リストから選択します。 **「チェーンコードのインストール (Install Chaincode)」**ボタンをクリックします。
<!--
  ![Chaincode screen](../images/chaincode_install_overview.png "Chaincode screen")
-->

2. **「チェーンコードのインストール (Install Chaincode)」**ポップアップ・パネルで、チェーンコードの名前とバージョンを入力します。 この名前とバージョンのストリングは、インストールされたチェーンコードと対話するためにアプリケーションで使用されることに**注意**してください。 **「参照」**ボタンをクリックし、ローカル・ファイル・システム内でチェーンコード・ソース・ファイルが格納されている場所にナビゲートします。 ピアにインストールするチェーンコードのソース・ファイルを 1 つ以上選択します。 次に、**「チェーンコード・タイプ (Chaincode Type)」**ドロップダウンからチェーンコード言語を選択します。

1 つまたは複数の GO あるいは NODE ファイルをアップロードすることによってチェーンコードをインストールするか、.zip ファイルに含めてチェーンコードをアップロードすることができます。.zip ファイルを使用すると、チェーンコードが完全なディレクトリー構造で保持されます。このことは、従属関係のパッケージを含めたり、CouchDB で索引を使用したりする場合に役立ちます。チェーンコードに索引を含める方法の例については、Fabric の
資料の [Using CouchDB from Chaincode![外部リンク・アイコン](../images/external_link.svg "外部リンク・アイコン")](http://hyperledger-fabric.readthedocs.io/en/release-1.1/couchdb_as_state_database.html#using-couchdb-from-chaincode){:new_window} を参照してください。また、[managing external dependencies for chaincode written in GO![外部リンク・アイコン](../images/external_link.svg "外部リンク・アイコン")](https://hyperledger-fabric.readthedocs.io/en/latest/chaincode4ade.html#managing-external-dependencies-for-chaincode-written-in-go){:new_window} で情報を参照することもできます。

  ![チェーンコードのインストール](../images/chaincode_install.png "チェーンコードのインストール")

## チェーンコードのインスタンス化
チャネルに参加するすべてのピアのファイル・システムにチェーンコードがインストールされた後、チャネル上でチェーンコードをインスタンス化して、ピアがチェーンコード・コンテナーを介して台帳と対話できるようにする必要があります。 このインスタンス化により、必要なチェーンコードの初期化が実行されます。 多くの場合、これにはチェーンコードの初期ワールド・ステートを構成するキー値ペアの設定が含まれます。

チェーンコードをインスタンス化するには、チャネルに対する**オペレーター**または**ライター**の権限が必要です。 複数の異なるピア上にある同じ名前とバージョンのチェーンコードは、チェーンコード・コンテナーをデプロイするために 1 回だけインスタンス化する必要があります。 以下の手順を実行して、チェーンコードをインスタンス化します。
1. ネットワーク・モニターの「コードのインストール (Install Code)」画面で、チェーンコードをインストールしたピアを選択し、インスタンス化するチェーンコードをチェーンコード表から見つけます。 その後、**「アクション」**ヘッダーの下にある**「インスタンス化」**ボタンをクリックします。
<!--
  ![Instantiate Chaincode](../images/chaincode_instantiate.png "Instantiate Chaincode")
-->

2. **「チェーンコードのインスタンス化 (Instantiate Chaincode)」**ポップアップ・パネルで、チェーンコードの初期化の引数としてキーと値のペアを設定し、インスタンス化するチャネルを選択します。  **「次へ」**をクリックします。
<!--
  ![Instantiate Chaincode panel](../images/chaincode_instantiate_panel.png "Instantiate Chaincode panel")
-->

3. チェーンコードの[エンドースメント・ポリシー](../glossary.html#endorsement-policy)を指定します。エンドースメント・ポリシーを設定する方法について詳しくは、[次のセクション](#specifying-chaincode-endorsement-policies)を参照してください。

## チェーンコードのエンドースメント・ポリシーの指定

エンドースメント・ポリシーを使用して、新規トランザクションを検証する必要のあるピアのセットを指定できます。例えば、エンドースメント・ポリシーで、チャネルのメンバーの大多数がトランザクションを承認する場合にのみそのトランザクションが台帳に追加されることを指定できます。

エンドースメント・ポリシーは、チャネルでチェーンコードがインスタンス化されるときに設定されます。チェーンコードをインスタンス化する組織は、チェーンコードをインストールしたチャネル・メンバーの中からどのメンバーがバリデーターになるのかを選択でき、すべてのチャネル・メンバーのエンドースメント・ポリシーを設定します。[チェーンコードの更新](#updating-a-chaincode)のステップに従ってから、2 つ目のステップでチェーンコードを再インスタンス化する際に新規ポリシーを指定することによって、エンドースメント・ポリシーを更新することができます。

ネットワーク・モニターを使用してエンドースメント・ポリシーを設定する場合、UI を使用して**単純ポリシー**を指定するか、または JSON を使用して**拡張ポリシー**を指定することができます。

* **UI を使用した単純ポリシーの指定:** まず、**「メンバーの追加」**ボタンをクリックしてトランザクションを検証できるメンバーのセットを選択します。次に、**「エンドースメント・ポリシー (Endorsement Policy)」**セクションで、トランザクションが承認済みになる前にリスト内のいくつのメンバーによってこのトランザクションが検証される必要があるかを決定します。この方法を使用して、すべてのチャネル・メンバー、大多数のチャネル・メンバー、1 つのメンバー、または単純ポリシーに自己署名できない 1 つのメンバーを加えた場合 (5 つのメンバーのうちの 2 つなど) のエンドースメント・ポリシーを指定することができます。何も変更しない場合、デフォルト・ポリシーによってチャネルのすべてのメンバーがトランザクションを承認することができます。

  ![単純エンドースメント・ポリシー](../images/simple_endorsement.png "単純エンドースメント・ポリシー")

* **JSON を使用した拡張ポリシーの指定:** 拡張ポリシーを指定し、重要なメンバーまたは管理者によるエンドースメントを必須とするか、特定のメンバーのエンドースメントに付与する重みづけを大きくします。

  拡張ポリシーを指定する最も簡単な方法は、UI 画面を使用して単純ポリシーの構築から開始することです。次に、**「拡張ポリシー (Advanced Policy)」**ボタンをクリックすると、単純ポリシーで設定したものと同じメンバーとルールが、JSON バージョンのポリシーに自動入力されます。これで、JSON を編集してより拡張されたバージョンを記述できるようになります。JSON でのエンドースメント・ポリシーの記述について詳しくは、[Hyperledger Fabric ノード SDK の資料![外部リンク・アイコン](../images/external_link.svg "外部リンク・アイコン")](https://fabric-sdk-node.github.io/global.html#ChaincodeInstantiateUpgradeRequest) を参照してください。<!--You can also find examples of advanced endorsement policies in the main [Hyperledger Fabric documentation![External link icon](../images/external_link.svg "External link icon")](https://hyperledger-fabric.readthedocs.io/en/latest/arch-deep-dive.html#example-endorsement-policies)-->

  ![拡張エンドースメント・ポリシー](../images/advanced_endorsement.png "拡張エンドースメント・ポリシー")

## チェーンコードの更新

チェーンコードを更新して、台帳上の資産との関係を維持しながら、チェーンコードのプログラミングを変更することができます。 インストールとインスタンス化は結びついているため、このチェーンコードを使用してチャネル上のすべてのピアでチェーンコードを更新する必要があります。 チェーンコードを更新するには、以下の手順を実行します。

1. 古いチェーンコードと同じ名前で別のバージョンのチェーンコードをインストールします。 [チェーンコードのインストール](install_instatiate_chaincode.html#Installing a chaincode)と同じ手順に従うことができます。 元のチェーンコードと同じチャネルを選択してください。

  ![チェーンコードの更新](../images/upgrade_chaincode.png "チェーンコードの更新")

2. 表で新しいチェーンコードを見つけて、**「アクション」**ヘッダーの下の**「更新」**ボタンをクリックします。 このアクションは、チェーンコードを再インスタンス化し、チェーンコード・コンテナーを新しいコンテナーに置き換えます。 更新関数の一部として新しい引数を入力する必要はないことに注意してください。

  ![更新ボタン](../images/upgrade_button.png "更新ボタン")
