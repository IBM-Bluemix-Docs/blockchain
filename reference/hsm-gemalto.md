---

copyright:
  years: 2020
lastupdated: "2020-03-09"

keywords: HSM, Gemalto, IBM Cloud

subcollection: blockchain

---

{:external: target="_blank" .external}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:pre: .pre}
{:table: .aria-labeledby="caption"}
{:codeblock: .codeblock}
{:note: .note}
{:tip: .tip}
{:download: .download}

# IBM Cloud Hardware Security Module (HSM)
{: #ibp-hsm-gemalto}
{: help}
{: support}

{{site.data.keyword.cloud_notm}} includes an HSM service that provides cryptographic processing for key generation, encryption, decryption, and key storage. This document describes how to use that service with the {{site.data.keyword.blockchainfull}} Platform.
{: shortdesc}


## Why would I want to to use an HSM with my {{site.data.keyword.blockchainfull_notm}} Platform network?
{: #ibp-hsm-gemalto}

When a CA, peer, or ordering node is configured to use an HSM, their private key is generated by and protected inside the HSM. Only the private keys of node identities are secured in the HSM. When a CA is configured to use HSM, the CA root private key is stored in the HSM. This is the key that is used to sign enrollment requests. After a peer or ordering node is configured to use HSM, the nodes are able to sign and endorse transactions without ever exposing their private key.

When you register other node admin or client application identities with a CA by using the console, their private keys are not stored inside the HSM because they will need their private key to transact on the network.  
{: important}

## Using Gemalto v6.x
{: #ibp-hsm-gemalto-using}

1. Provision the HSM and configure it with at least one partition. For example, you can follow instructions for [Provisioning {{site.data.keyword.cloud_notm}} HSM](/docs/infrastructure/hardware-security-modules?topic=hardware-security-modules-provisioning-ibm-cloud-hsm){: external}.

2. [Install the HSM client](/docs/infrastructure/hardware-security-modules?topic=hardware-security-modules-installing-the-ibm-cloud-hsm-client){: external} on your local machine.

3. Using the HSM client, you can get the server certificate by running the following command:

  ```bash
  scp hsm_admin@${HSM_ADDRESS}:server.pem server.pem
  ```
  {: codeblock}

  Replace
  - {HSM_ADDRESS} with ...

4. Run the following command to add the HSM server to local client:

  ```bash
  vtl addServer -n ${HSM_ADDRESS} -c server.pem
  ```
  {: codeblock}

  Replace
  - {HSM_ADDRESS} with ...

5. Create the certificates for client by running the command:

  ```bash
  vtl createcert -n ${CLIENT_ADDRESS}
  ```
  {: codeblock}

  Replace
  - {CLIENT_ADDRESS} with ...

6. Copy the client certs to the server by running the command:

  ```bash
  scp /usr/safenet/lunaclient/cert/client/${CLIENT_ADDRESS}.pem hsm_admin@${HSM_ADDRESS}:.
  ```
  {: codeblock}

  Replace
  - {CLIENT_ADDRESS} with ...
  - {HSM_ADDRESS} with ...


7. On the HSM server register the client with the command:

  ```bash
  # if the client address is IP address run:
  client register -client ${CLIENT_NAME} -ip ${CLIENT_ADDRESS}

  # else if the client address is fqdn run:
  client register -client ${CLIENT_NAME} -hostname ${CLIENT_ADDRESS}
  ```
  {: codeblock}

  Replace
  - {CLIENT_NAME} with ...
  - {CLIENT_ADDRESS} with ...
  - {HSM_ADDRESS} with ...

8. Restart the ntls service on the HSM server

  ```bash
  service restart ntls
  ```
  {: codeblock}


9. Assign a partition to newly created client on the HSM server by running the following command:

  ```bash
  client assignpartition -client ${CLIENT_NAME} -partition ${PARTITION_NAME}

  # to check if it worked
  client show -client ${CLIENT_NAME}
  ```
  {: codeblock}

Replace
- {CLIENT_NAME} with ...
- {PARTITION_NAME} with ...

10. Verify the client can connect to HSM server by running the command:

  ```bash
  vtl verify
  ```
{: codeblock}

## What's next
{: #ibp-hsm-gemalto-next-steps}

After you have used these instructions to configure your Gemalto HSM, see [Configuring a node to use a HSM](/docs/blockchain?topic=blockchain-ibp-console-adv-deployment#ibp-console-adv-deployment-cfg-hsm) to learn more about the next steps for configuring a blockchain node to use the HSM.  

## TODO
1. Ash ran some command on hsm server to make sure that the server doesnt check the clients address, to make it run on docker/k8s
2. How to get client address
3. Do we need more detail about the step of configuring the hsm
4. How to mount the certs created in step 3 and 5 to the pod
5. How to setup the pod
6. How to setup service
7. Final checks if it worked before moving on to create blockchain components
